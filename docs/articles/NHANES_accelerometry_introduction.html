<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to downloading and working with NHANES 2003-2004 and 2005-2006 accelerometry data • rnhanesdata</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to downloading and working with NHANES 2003-2004 and 2005-2006 accelerometry data">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rnhanesdata</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/NHANES_accelerometry_introduction.html">Introduction to downloading and working with NHANES 2003-2004 and 2005-2006 accelerometry data</a>
    </li>
    <li>
      <a href="../articles/create-all-processed-data.html">Creating all processed data in the rnhanesdata package</a>
    </li>
    <li>
      <a href="../articles/estimate-bedtime-midpoints.html">estimate-bedtime-midpoints</a>
    </li>
    <li>
      <a href="../articles/vignette_prediction.html">The predictive performance of objective activity measures derived from accelerometry data for 5-year all-cause mortality in NHANES</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/andrew-leroux/rnhanesdata">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="NHANES_accelerometry_introduction_files/kePrint-0.0.1/kePrint.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Introduction to downloading and working with NHANES 2003-2004 and 2005-2006 accelerometry data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/andrew-leroux/rnhanesdata/blob/master/vignettes/NHANES_accelerometry_introduction.Rmd"><code>vignettes/NHANES_accelerometry_introduction.Rmd</code></a></small>
      <div class="hidden name"><code>NHANES_accelerometry_introduction.Rmd</code></div>

    </div>

    
    
<p>This vignette illustrates how to download and work NHANES 2003-2004 and 2005-2006 accelerometry data. We also issustrate how to access the prediction performance of objective physical activity measures and their ranking relative to other established predictors of 5-year all-cause mortality in the US. In this analysis, we use participants between 50 and 85 years old from the 2003-2004 and 2005-2006 samples of the National Health and Nutritional Examination Survey (NHANES, n=2978, number of deaths in 5 years=297) who wore a hip-worn accelerometer in the free living environment for up to 7 days.</p>
<p><strong>Note: the html file displays only partial R code neccesary to illustrate the functions and arguments used to execute the analysis. Full code is available in the corresponding .Rmd file and can be displayed by setting echo = TRUE in the R chunk option (e.g., {r, echo = TRUE}).</strong></p>
<div id="prerequisites" class="section level1">
<h1 class="hasAnchor">
<a href="#prerequisites" class="anchor"></a>Prerequisites</h1>
<p>The following packages will be used in this vignette to provide illustration of NHANES 5-year mortality prediction model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pckgs &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"knitr"</span>,<span class="st">"kableExtra"</span>,              ## packages used for creating Tables
           <span class="st">"devtools"</span>,                        ## package used to download R packages stored on GitHub
           <span class="st">"ggplot2"</span>, <span class="st">"gridExtra"</span>,            ## packages for plotting 
           <span class="st">"corrplot"</span>,                        ## for correlation plot
           <span class="st">"reshape2"</span>,                        ## for transforming data long -&gt; wide and wide -&gt; long 
           <span class="st">"dplyr"</span>,                           ## packages for merging/transforming data
           <span class="st">"survey"</span>,                          ## package used for analyzing complex survey data in R
           <span class="st">"mgcv"</span>, <span class="st">"refund"</span>                   ## packages used for smoothing/fpca
           )
<span class="kw"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(pckgs, <span class="cf">function</span>(x) <span class="cf">if</span>(<span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(x,<span class="dt">character.only=</span><span class="ot">TRUE</span>,<span class="dt">quietly=</span><span class="ot">TRUE</span>)) {
    <span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(x)
    <span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(x, <span class="dt">character.only=</span><span class="ot">TRUE</span>)
})
<span class="kw"><a href="https://rdrr.io/r/base/rm.html">rm</a></span>(<span class="dt">list=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"pckgs"</span>))

<span class="co">#rnhanes data package from github</span>
<span class="cf">if</span>(<span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(<span class="st">"rnhanesdata"</span>)){
    <span class="kw">install_github</span>(<span class="st">"andrew-leroux/rnhanesdata"</span>)
    <span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(<span class="st">"rnhanesdata"</span>)
}

<span class="kw"><a href="https://rdrr.io/r/base/Random.html">RNGkind</a></span>(<span class="dt">sample.kind=</span><span class="st">"Rounding"</span>)</code></pre></div>
<div id="nhanes-2003-2004-and-2005-2006-5-year-mortality-model-data-selection" class="section level2">
<h2 class="hasAnchor">
<a href="#nhanes-2003-2004-and-2005-2006-5-year-mortality-model-data-selection" class="anchor"></a>NHANES 2003-2004 and 2005-2006 5-year mortality model data selection</h2>
<p>We start by downloading NHANES 2003-2004 and 2005-2006 cohorts’ information, processing data and combining survey weights for the two cohorts using R package <em>rnhanesdata</em> (Leroux, 2018). Items 1 - 11 illustrate processing steps we performed to obtain the subset of NHANES data that meets this analysis criteria, and derive activity summaries. These steps produce an R object called “data_analysis”, which is used in 5-year mortality prediction model.</p>
<p><strong>Note: data dictionary and description of variable names is available in NHANES_processed.pdf document</strong></p>
<ol style="list-style-type: decimal">
<li>Download and process NHANES lab measurements from the 2 cohorts: systolic blood pressure readings, total cholesterol, and HDL cholesterol. These data are saved in the temporary directory, which is then removed once the covariates information is processed. Blood pressure is recorded up to 4 times here for each participant. The data collection procedure and description of cholesterol and blood pressure variables is available at <a href="https://wwwn.cdc.gov/nchs/nhanes/search/datapage.aspx?Component=Examination&amp;CycleBeginYear=2003" class="uri">https://wwwn.cdc.gov/nchs/nhanes/search/datapage.aspx?Component=Examination&amp;CycleBeginYear=2003</a> for the wave 2003-2004 and at <a href="https://wwwn.cdc.gov/nchs/nhanes/search/datapage.aspx?Component=Examination&amp;CycleBeginYear=2005" class="uri">https://wwwn.cdc.gov/nchs/nhanes/search/datapage.aspx?Component=Examination&amp;CycleBeginYear=2005</a> for the wave 2005-2006.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create a (local) temporary directory </span>
<span class="co"># where lab measurement (cholesterol, blood presure) data will be downloaded from the CDC website </span>
<span class="co"># and then loaded into R. These files need to be downloaded separately as </span>
<span class="co"># the raw files associated with these lab measurements are not included in the rnhanesdata package.</span>
dir_tmp =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span>()
<span class="kw"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span>(dir_tmp)

<span class="cf">if</span> (<span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/files2.html">dir.exists</a></span>(dir_tmp)){
  <span class="kw"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span>(dir_tmp, <span class="dt">showWarnings =</span> <span class="ot">FALSE</span>)
}
dl_file =<span class="st"> </span><span class="cf">function</span>(url) {
  bn =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/basename.html">basename</a></span>(url) 
  destfile =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(dir_tmp, bn)
  <span class="cf">if</span> (<span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span>(destfile)) {
    out =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span>(url, <span class="dt">destfile =</span> destfile, <span class="dt">mode=</span><span class="st">"wb"</span>)
  }
  <span class="kw"><a href="https://rdrr.io/r/base/stopifnot.html">stopifnot</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span>(destfile))
}
## download the lab measurement data for the cohort 2003-2004
<span class="co"># Cholesterol - Total &amp; HDL: LBXTC and LBXHDD</span>
<span class="kw">dl_file</span>(<span class="st">"https://wwwn.cdc.gov/Nchs/Nhanes/2003-2004/L13_C.XPT"</span>)
<span class="co"># Blood Pressure: BPXSY1 , BPXSY2, BPXSY3 and BPXSY4</span>
<span class="kw">dl_file</span>(<span class="st">"https://wwwn.cdc.gov/Nchs/Nhanes/2003-2004/BPX_C.XPT"</span>)

## download the lab measurement data for the cohort 2005-2006
<span class="co"># Total Cholesterol: LBXTC</span>
<span class="kw">dl_file</span>(<span class="st">"https://wwwn.cdc.gov/Nchs/Nhanes/2005-2006/TCHOL_D.XPT"</span>)
<span class="co"># HDL Cholesterol: LBDHDD</span>
<span class="kw">dl_file</span>(<span class="st">"https://wwwn.cdc.gov/Nchs/Nhanes/2005-2006/HDL_D.XPT"</span>)
<span class="co"># Blood Pressure, up to 4 measurements per person: BPXSY1 , BPXSY2, BPXSY3 and BPXSY4</span>
<span class="kw">dl_file</span>(<span class="st">"https://wwwn.cdc.gov/Nchs/Nhanes/2005-2006/BPX_D.XPT"</span>)


varnames &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"LBXTC"</span>,<span class="st">"LBXHDD"</span>,<span class="st">"LBDHDD"</span>,           ## 1. cholesterol. Note LBXHDD and LBDHDD are the same variable, 
                                                   ##    but different names for 2003-2004 and 2005-2006 cohorts
              <span class="st">"BPXSY1"</span>,<span class="st">"BPXSY2"</span>,<span class="st">"BPXSY3"</span>, <span class="st">"BPXSY4"</span> ## 2. blood pressure measurements
              )

## load and merge the lab data
lab_data &lt;-<span class="st"> </span><span class="kw"><a href="../reference/process_covar.html">process_covar</a></span>(<span class="dt">varnames=</span>varnames,<span class="dt">localpath=</span>dir_tmp)

## change column name for cholesterol variable that changed names
<span class="kw"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(lab_data<span class="op">$</span>Covariate_C)[<span class="kw"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(lab_data<span class="op">$</span>Covariate_C) <span class="op">==</span><span class="st"> "LBXHDD"</span>] &lt;-<span class="st"> "LBDHDD"</span>

## combine waves
CVMarkers &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(lab_data<span class="op">$</span>Covariate_C, lab_data<span class="op">$</span>Covariate_D)

<span class="kw"><a href="https://rdrr.io/r/base/rm.html">rm</a></span>(<span class="dt">list=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"lab_data"</span>,<span class="st">"dir_tmp"</span>,<span class="st">"varnames"</span>))</code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Load minute-level activity data and combine it with lab measurements, survey sampling data, and mortality data which are included in the <em>rnhanesdata</em> package.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## load the data
<span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"PAXINTEN_C"</span>);<span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"PAXINTEN_D"</span>) <span class="co">#processed physical activity data 2003-2004 and 2005-2006, respectively</span>
<span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"Flags_C"</span>);<span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"Flags_D"</span>)
<span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"Mortality_2015_C"</span>);<span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"Mortality_2015_D"</span>)
<span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"Covariate_C"</span>);<span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"Covariate_D"</span>)

## re-code activity counts which are considered "non-wear" to be 0
## this doesn't impact many data points, most estimated non-wear times correspond to 0 counts
PAXINTEN_C[,<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"MIN"</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">1440</span>)] &lt;-<span class="st"> </span>PAXINTEN_C[,<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"MIN"</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">1440</span>)]<span class="op">*</span>Flags_C[,<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"MIN"</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">1440</span>)]
PAXINTEN_D[,<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"MIN"</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">1440</span>)] &lt;-<span class="st"> </span>PAXINTEN_D[,<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"MIN"</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">1440</span>)]<span class="op">*</span>Flags_D[,<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"MIN"</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">1440</span>)]

## Merge covariate, mortality, and accelerometry data
## note that both PAXINTEN_* and Covariate_* have a column
## called "SDDSRVYR" indicating which NHANES wave the data is associated with.
## To avoid duplicating this column in the merged data, we add this variable to the "by"
## argument in left_join()
AllAct_C &lt;-<span class="st"> </span><span class="kw">left_join</span>(PAXINTEN_C, Mortality_2015_C, <span class="dt">by =</span> <span class="st">"SEQN"</span>) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">left_join</span>(Covariate_C, <span class="dt">by=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"SEQN"</span>, <span class="st">"SDDSRVYR"</span>))
AllAct_D &lt;-<span class="st"> </span><span class="kw">left_join</span>(PAXINTEN_D, Mortality_2015_D, <span class="dt">by =</span> <span class="st">"SEQN"</span>) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">left_join</span>(Covariate_D, <span class="dt">by=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"SEQN"</span>, <span class="st">"SDDSRVYR"</span>))

AllFlags_C &lt;-<span class="st"> </span><span class="kw">left_join</span>(Flags_C, Mortality_2015_C, <span class="dt">by =</span> <span class="st">"SEQN"</span>) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">left_join</span>(Covariate_C, <span class="dt">by=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"SEQN"</span>, <span class="st">"SDDSRVYR"</span>))
AllFlags_D &lt;-<span class="st"> </span><span class="kw">left_join</span>(Flags_D, Mortality_2015_D, <span class="dt">by =</span> <span class="st">"SEQN"</span>) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">left_join</span>(Covariate_D, <span class="dt">by=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"SEQN"</span>, <span class="st">"SDDSRVYR"</span>))

## clean up the workspace for memory purposes
<span class="kw"><a href="https://rdrr.io/r/base/rm.html">rm</a></span>(<span class="dt">list=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"PAXINTEN_"</span>, <span class="st">"Covariate_"</span>,<span class="st">"Mortality_2015_"</span>,<span class="st">"Flags_"</span>),<span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(LETTERS[<span class="dv">3</span><span class="op">:</span><span class="dv">4</span>],<span class="dt">each=</span><span class="dv">4</span>))))

## combine data for the two waves
AllAct   &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(AllAct_C,AllAct_D)
AllFlags &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(AllFlags_C,AllFlags_D)

<span class="co">#merge with cardiovascular markers </span>
AllAct &lt;-<span class="st"> </span><span class="kw">left_join</span>(AllAct, CVMarkers, <span class="dt">by =</span> <span class="st">"SEQN"</span>)
AllFlags &lt;-<span class="st"> </span><span class="kw">left_join</span>(AllFlags, CVMarkers, <span class="dt">by =</span> <span class="st">"SEQN"</span>)

## clean up the workspace again
<span class="kw"><a href="https://rdrr.io/r/base/rm.html">rm</a></span>(<span class="dt">list=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"AllAct_C"</span>,<span class="st">"AllAct_D"</span>,<span class="st">"AllFlags_C"</span>,<span class="st">"AllFlags_D"</span>,<span class="st">"CVMarkers"</span>))</code></pre></div>
<p>Activity data has the following format</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">kable</span>(<span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(AllAct)[,<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>])<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">kable_styling</span>(<span class="st">"striped"</span>, <span class="dt">full_width =</span> F)</code></pre></div>
<table class="table table table-striped">
<thead><tr>
<th style="text-align:right;">
SEQN
</th>
<th style="text-align:right;">
PAXCAL
</th>
<th style="text-align:right;">
PAXSTAT
</th>
<th style="text-align:right;">
WEEKDAY
</th>
<th style="text-align:right;">
SDDSRVYR
</th>
<th style="text-align:right;">
MIN1
</th>
<th style="text-align:right;">
MIN2
</th>
<th style="text-align:right;">
MIN3
</th>
<th style="text-align:right;">
MIN4
</th>
<th style="text-align:right;">
MIN5
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
21005
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
21005
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
21005
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
21005
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
21005
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
21005
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
<p>Variable descriptions can be found by calling accelerometry data help files</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><a href="../reference/PAXINTEN_C.html">?PAXINTEN_C
?PAXINTEN_D</a></code></pre></div>
<p>Here,</p>
<p>SEQN: Respondent sequence number</p>
<p>WEEKDAY: Day of the week; WEEKDAY=1 for Sunday, 2 for Monday and so forth</p>
<p>PAXCAL: Denotes whether the monitor was in calibration when it was returned by the subject. The data for monitors that were out of calibration (PAXCAL=2) may be less reliable.</p>
<p>PAXSTAT: Component status code with PAXSTAT=1 for records with data that are deemed reliable. A PAXSTAT=2 was used to code records that had some questionable data; analysts may wish to examine these records more closely.</p>
<p>SDDSRVYR: Variable indicating which wave of the NHANES study this data is associated with. For example, SDDSRVYR = 3 corresponds to the 2003-2004 wave and SDDSRVYR = 4 corresponds to the 2005-2006 wave.</p>
<p>MIN1 - MIN1440: minute-level activity step count summary, where MIN1 corresponds to 12:00am, MIN2 to 12:01am and so on.</p>
<p>We can extract and plot participants 31128 and 31193 activity data</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df.act &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(AllAct, SEQN <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">31128</span>, <span class="dv">31193</span>))

<span class="kw">kable</span>(df.act[,<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>],<span class="dt">format =</span> <span class="st">"html"</span>, <span class="dt">caption =</span> <span class="st">"First 5 minutes for two participants activity data"</span>, 
      <span class="dt">row.names =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">kable_styling</span>(<span class="st">"striped"</span>, <span class="dt">full_width =</span> F)</code></pre></div>
<table class="table table table-striped">
<caption>
First 5 minutes for two participants activity data
</caption>
<thead><tr>
<th style="text-align:right;">
SEQN
</th>
<th style="text-align:right;">
PAXCAL
</th>
<th style="text-align:right;">
PAXSTAT
</th>
<th style="text-align:right;">
WEEKDAY
</th>
<th style="text-align:right;">
SDDSRVYR
</th>
<th style="text-align:right;">
MIN1
</th>
<th style="text-align:right;">
MIN2
</th>
<th style="text-align:right;">
MIN3
</th>
<th style="text-align:right;">
MIN4
</th>
<th style="text-align:right;">
MIN5
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
31128
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
166
</td>
<td style="text-align:right;">
27
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
276
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
31128
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
31128
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
31128
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
31128
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
31128
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
31128
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
31193
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
31193
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
335
</td>
<td style="text-align:right;">
2598
</td>
<td style="text-align:right;">
2185
</td>
<td style="text-align:right;">
1703
</td>
<td style="text-align:right;">
1378
</td>
</tr>
<tr>
<td style="text-align:right;">
31193
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
463
</td>
<td style="text-align:right;">
375
</td>
<td style="text-align:right;">
58
</td>
<td style="text-align:right;">
119
</td>
<td style="text-align:right;">
167
</td>
</tr>
<tr>
<td style="text-align:right;">
31193
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
31193
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
31193
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
31193
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#smooth activity  data</span>
x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">1440</span>
<span class="co">#has to be converted to a numeric matrix type before smoothing is applied</span>
tmp &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(df.act[,<span class="kw"><a href="https://rdrr.io/r/base/grep.html">grep</a></span>(<span class="st">"MIN"</span>, <span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(df.act))])
<span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(df.act)){
  tmp[i,] &lt;-<span class="st"> </span><span class="kw">gam</span>(tmp[i,]<span class="op">~</span><span class="kw">s</span>(x,<span class="dt">k=</span><span class="dv">30</span>))<span class="op">$</span>fitted.values
}</code></pre></div>
<p><img src="NHANES_accelerometry_introduction_files/figure-html/unnamed-chunk-7-1.png" width="960" style="display: block; margin: auto;"></p>
<p><img src="NHANES_accelerometry_introduction_files/figure-html/unnamed-chunk-10-1.png" width="960" style="display: block; margin: auto;"></p>
<ol start="3" style="list-style-type: decimal">
<li>Create new factor covariates from NHANES questionnaire, which will be used in the prediction model. In addition, calculate average systolic blood pressure using the 4 measurements per participant.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Code year 5 mortality, NAs for individuals with follow up less than 5 years and alive
AllAct<span class="op">$</span>yr5_mort &lt;-<span class="st"> </span>AllFlags<span class="op">$</span>yr5_mort &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(AllAct<span class="op">$</span>permth_exm<span class="op">/</span><span class="dv">12</span> <span class="op">&lt;=</span><span class="st"> </span><span class="dv">5</span> <span class="op">&amp;</span><span class="st"> </span>AllAct<span class="op">$</span>mortstat <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="dv">1</span>,
  <span class="kw"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(AllAct<span class="op">$</span>permth_exm<span class="op">/</span><span class="dv">12</span> <span class="op">&lt;</span><span class="st"> </span><span class="dv">5</span> <span class="op">&amp;</span><span class="st"> </span>AllAct<span class="op">$</span>mortstat <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, <span class="ot">NA</span>, <span class="dv">0</span>))
                                                    )
## Create Age in years using the age at examination (i.e. when participants wore the device)
AllAct<span class="op">$</span>Age &lt;-<span class="st"> </span>AllFlags<span class="op">$</span>Age &lt;-<span class="st"> </span>AllAct<span class="op">$</span>RIDAGEEX<span class="op">/</span><span class="dv">12</span>

## Re-level comorbidities to assign refused/don't know as not having the condition
## Note that in practice this does not affect many individuals, but it is an assumption we're making.
<span class="kw"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(AllAct<span class="op">$</span>CHD)&lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(AllFlags<span class="op">$</span>CHD)&lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">"No"</span> =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"No"</span>,<span class="st">"Refused"</span>,<span class="st">"Don't know"</span>), <span class="st">"Yes"</span> =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Yes"</span>))
<span class="kw"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(AllAct<span class="op">$</span>CHF)&lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(AllFlags<span class="op">$</span>CHF)&lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">"No"</span> =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"No"</span>,<span class="st">"Refused"</span>,<span class="st">"Don't know"</span>), <span class="st">"Yes"</span> =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Yes"</span>))
<span class="kw"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(AllAct<span class="op">$</span>Stroke)&lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(AllFlags<span class="op">$</span>Stroke)&lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">"No"</span> =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"No"</span>,<span class="st">"Refused"</span>,<span class="st">"Don't know"</span>), <span class="st">"Yes"</span> =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Yes"</span>))
<span class="kw"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(AllAct<span class="op">$</span>Cancer) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(AllFlags<span class="op">$</span>Cancer) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">"No"</span> =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"No"</span>,<span class="st">"Refused"</span>,<span class="st">"Don't know"</span>), <span class="st">"Yes"</span> =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Yes"</span>))
<span class="kw"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(AllAct<span class="op">$</span>Diabetes) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(AllFlags<span class="op">$</span>Diabetes) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">"No"</span> =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"No"</span>,<span class="st">"Borderline"</span>, <span class="st">"Refused"</span>,<span class="st">"Don't know"</span>), <span class="st">"Yes"</span> =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Yes"</span>))


## Re-level education to have 3 levels and categorize don't know/refused to be missing
<span class="kw"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(AllAct<span class="op">$</span>EducationAdult) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(AllFlags<span class="op">$</span>EducationAdult) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
  <span class="st">"Less than high school"</span> =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Less than 9th grade"</span>, <span class="st">"9-11th grade"</span>),
   <span class="st">"High school"</span> =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"High school grad/GED or equivalent"</span>),
   <span class="st">"More than high school"</span> =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Some College or AA degree"</span>, <span class="st">"College graduate or above"</span>))

## Re-level alcohol consumption to include a level for "missing"
<span class="kw"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(AllAct<span class="op">$</span>DrinkStatus) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(AllFlags<span class="op">$</span>DrinkStatus) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(AllAct<span class="op">$</span>DrinkStatus), 
                                                                <span class="st">"Missing alcohol"</span>)
AllAct<span class="op">$</span>DrinkStatus[<span class="kw"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(AllAct<span class="op">$</span>DrinkStatus)] &lt;-<span class="st"> </span>
<span class="st">  </span>AllFlags<span class="op">$</span>DrinkStatus[<span class="kw"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(AllAct<span class="op">$</span>DrinkStatus)] &lt;-<span class="st"> "Missing alcohol"</span>


<span class="co"># systolic blood pressure calculation </span>
AllAct<span class="op">$</span>SYS &lt;-<span class="st"> </span>AllFlags<span class="op">$</span>SYS &lt;-<span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(AllAct[,<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"BPXSY1"</span>,<span class="st">"BPXSY2"</span>,<span class="st">"BPXSY3"</span>, <span class="st">"BPXSY4"</span>)],
                            <span class="dv">1</span>,mean, <span class="dt">na.rm=</span> T))

## Re-order columns so that activity and wear/non-wear flags are the last 1440 columns of our two
## data matrices. This is a personal preference and is absolutely not necessary.
act_cols &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(AllAct) <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"MIN"</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">1440</span>))
oth_cols &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(AllAct) <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"MIN"</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">1440</span>))
AllAct   &lt;-<span class="st"> </span>AllAct[,<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(oth_cols,act_cols)]
AllFlags &lt;-<span class="st"> </span>AllFlags[,<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(oth_cols,act_cols)]
<span class="kw"><a href="https://rdrr.io/r/base/rm.html">rm</a></span>(<span class="dt">list=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"act_cols"</span>,<span class="st">"oth_cols"</span>))</code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Calculate daily activity summary measures:</li>
</ol>
<ol style="list-style-type: lower-alpha">
<li><p>total activity count (TAC);</p></li>
<li><p>total log activity count (TLAC);</p></li>
<li><p>total accelerometer wear time (WT);</p></li>
<li><p>total sedentary (&lt; 100 counts) time (ST);</p></li>
<li><p>total minutes of moderate/vigorous (&lt;=2020 counts) physical activity (MVPA);</p></li>
<li><p>sedentary/sleep/non-wear to active transition probability (SATP<span class="math inline">\(_{sl/nw}\)</span>);</p></li>
<li><p>active to sedentary/sleep/non-wear transition probability (ASTP<span class="math inline">\(_{sl/nw}\)</span>).</p></li>
</ol>
<p>In addition, compute total log activity count summary measures (TLAC_1, TLAC_2, …, TLAC_12) in each 2-hr window, i.e. 12AM-2AM, 2AM-4AM, 4AM-6AM, etc.</p>
<p>Note, there is one individual with 501 minutes recorded as NA. These missing data occur on the last day they wore the device for the last 501 minutes of the day. We impute these missing data with 0.</p>
<p>Decsription of these activity related measures is available at: <a href="https://www.biorxiv.org/content/10.1101/182337v1" class="uri">https://www.biorxiv.org/content/10.1101/182337v1</a></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Assign just the activity and wear/non-wear flag data to matrices.
## This makes computing the features faster but is technically required.
act_mat  &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(AllAct[,<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"MIN"</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">1440</span>)])
flag_mat &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(AllFlags[,<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"MIN"</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">1440</span>)])

## replace NAs with 0s
act_mat[<span class="kw"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(act_mat)]   &lt;-<span class="st"> </span><span class="dv">0</span>
flag_mat[<span class="kw"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(flag_mat)] &lt;-<span class="st"> </span><span class="dv">0</span>

<span class="co">#total activity count (TAC)</span>
AllAct<span class="op">$</span>TAC   &lt;-<span class="st"> </span>AllFlags<span class="op">$</span>TAC   &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span>(act_mat)
<span class="co">#total log activity count (TLAC)</span>
AllAct<span class="op">$</span>TLAC  &lt;-<span class="st"> </span>AllFlags<span class="op">$</span>TLAC  &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="dv">1</span><span class="op">+</span>act_mat))
<span class="co">#total accelerometer wear time (WT)</span>
AllAct<span class="op">$</span>WT    &lt;-<span class="st"> </span>AllFlags<span class="op">$</span>WT    &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span>(flag_mat)
<span class="co">#total sedentary  time (ST)</span>
AllAct<span class="op">$</span>ST    &lt;-<span class="st"> </span>AllFlags<span class="op">$</span>ST    &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span>(act_mat <span class="op">&lt;</span><span class="st"> </span><span class="dv">100</span>)
<span class="co">#total   time spent in moderate to vigorous physical activity (MVPA)</span>
AllAct<span class="op">$</span>MVPA  &lt;-<span class="st"> </span>AllFlags<span class="op">$</span>MVPA  &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span>(act_mat <span class="op">&gt;=</span><span class="st"> </span><span class="dv">2020</span>)

## calculate fragmentation measures
bout_mat &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(act_mat <span class="op">&gt;=</span><span class="st"> </span><span class="dv">100</span>, <span class="dv">1</span>, <span class="cf">function</span>(x){
                        mat &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/rle.html">rle</a></span>(x)
                        sed &lt;-<span class="st"> </span>mat<span class="op">$</span>lengths[<span class="kw"><a href="https://rdrr.io/r/base/which.html">which</a></span>(mat<span class="op">$</span>values <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>)]
                        act &lt;-<span class="st"> </span>mat<span class="op">$</span>length[mat<span class="op">$</span>values <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>]

                        sed &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(sed) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, <span class="ot">NA</span>, <span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(sed))
                        act &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(act) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, <span class="ot">NA</span>, <span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(act))
                        <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(sed,act)
                    })

AllAct<span class="op">$</span>SBout &lt;-<span class="st"> </span>AllFlags<span class="op">$</span>SBout &lt;-<span class="st"> </span>bout_mat[<span class="dv">1</span>,]
AllAct<span class="op">$</span>ABout &lt;-<span class="st"> </span>AllFlags<span class="op">$</span>ABout &lt;-<span class="st"> </span>bout_mat[<span class="dv">2</span>,]
AllAct<span class="op">$</span>SATP  &lt;-<span class="st"> </span>AllFlags<span class="op">$</span>SATP  &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span>AllAct<span class="op">$</span>SBout
AllAct<span class="op">$</span>ASTP  &lt;-<span class="st"> </span>AllFlags<span class="op">$</span>ASTP  &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span>AllAct<span class="op">$</span>ABout



<span class="co"># compute total log activity count in each 2-hr window, </span>
<span class="co"># 2 hour (120 minutes) binning window </span>
tlen &lt;-<span class="st"> </span><span class="dv">120</span>
nt   &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Round.html">floor</a></span>(<span class="dv">1440</span><span class="op">/</span>tlen)
<span class="co"># create a list of indices for binning into 2-hour windows</span>
inx_col_ls &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/split.html">split</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">1440</span>, <span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="dv">1</span><span class="op">:</span>nt,<span class="dt">each=</span>tlen))
Act_2hr    &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(inx_col_ls, <span class="cf">function</span>(x) <span class="kw"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="dv">1</span><span class="op">+</span>act_mat[,x,<span class="dt">drop=</span><span class="ot">FALSE</span>])))
<span class="kw"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(Act_2hr) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"TLAC_"</span>,<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">12</span>))


AllAct   &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(AllAct, Act_2hr)
AllFlags &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(AllFlags, Act_2hr)

<span class="kw"><a href="https://rdrr.io/r/base/rm.html">rm</a></span>(<span class="dt">list=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"tlen"</span>,<span class="st">"nt"</span>,<span class="st">"inx_col_ls"</span>,<span class="st">"Act_2hr"</span>,<span class="st">"act_mat"</span>,<span class="st">"flag_mat"</span>,<span class="st">"bout_mat"</span>))</code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>From the total of</li>
</ol>
<p>14631 exclude participants who were:</p>
<ol style="list-style-type: lower-roman">
<li><p>younger than 50 years old, or 85 and older at the time they wore the accelerometer (10859 participants);</p></li>
<li><p>missing BMI or education predictor variables (41 participants);</p></li>
<li><p>had fewer than 3 days of data with at least 10 hours of estimated wear time (517 participants);</p></li>
<li><p>missing mortality information (21 participants);</p></li>
<li><p>alive with follow up less than 5 years (0 participants);</p></li>
<li><p>missing systolic blood pressure, total cholesterol or HDL cholesterol measurements (293 participants).</p></li>
</ol>
<p>The number of participants with missing data for all pairwise combinations of variables with missing data:</p>
<table class="table table table-striped">
<caption>
Missing data patterns
</caption>
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
BMI
</th>
<th style="text-align:right;">
Education
</th>
<th style="text-align:right;">
Bad Accel Data
</th>
<th style="text-align:right;">
Mortality
</th>
<th style="text-align:right;">
Follow-up
</th>
<th style="text-align:right;">
Lab
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
BMI
</td>
<td style="text-align:right;">
35
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
Education
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Bad Accel Data
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
517
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
57
</td>
</tr>
<tr>
<td style="text-align:left;">
Mortality
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Follow-up
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
Lab
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
57
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
293
</td>
</tr>
</tbody>
</table>
<ol start="6" style="list-style-type: decimal">
<li>Create our dataset for analysis, “data_analysis”, with one row per subject containing only those subjects who meet our inclusion criteria.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Create our dataset for analysis with one row per subject
## containing only those subjects who meet our inclusion criteria.
data_analysis  &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(table_dat, Exclude <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)
## get adjusted survey weights using the reweight_accel function
data_analysis  &lt;-<span class="st"> </span><span class="kw"><a href="../reference/reweight_accel.html">reweight_accel</a></span>(data_analysis)

## Get activity/flag data for only those included participants AND days.
## Since we've already removed the "bad" days from Act_Analysis and Act_Flags,
## we need only subset based on subject ID now
Act_Analysis   &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(Act_Analysis, SEQN <span class="op">%in%</span><span class="st"> </span>data_analysis<span class="op">$</span>SEQN)
Flags_Analysis &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(Flags_Analysis, SEQN <span class="op">%in%</span><span class="st"> </span>data_analysis<span class="op">$</span>SEQN)</code></pre></div>
<p>Thus, after exclusion ctriteria were applied, the data set contained 2978 subjects. Among these participants, 86 had missing alcohol information; for these participants we introduced the category “Missing Alcohol” and retained them in the dataset.</p>
<p>Maximum follow-up time in this cohort</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(data_analysis<span class="op">$</span>permth_exm<span class="op">/</span><span class="dv">12</span>)</code></pre></div>
<pre><code>## [1] 13.08333</code></pre>
<ol start="7" style="list-style-type: decimal">
<li>Calculate subject specific averages of the accelerometry features using only the “good” days of data.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## calculate subject specific averages of the accelerometry features
## using only the "good" days of data
act_var_nms &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"TAC"</span>,<span class="st">"TLAC"</span>,<span class="st">"WT"</span>,<span class="st">"ST"</span>,<span class="st">"MVPA"</span>,<span class="st">"ABout"</span>,<span class="st">"SBout"</span>,<span class="st">"SATP"</span>,<span class="st">"ASTP"</span>, <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"TLAC_"</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">12</span>))
<span class="cf">for</span>(i <span class="cf">in</span> act_var_nms){
    data_analysis[[i]] &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/lapply.html">vapply</a></span>(data_analysis<span class="op">$</span>SEQN, <span class="cf">function</span>(x) <span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(Act_Analysis[[i]][Act_Analysis<span class="op">$</span>SEQN<span class="op">==</span>x]), <span class="kw"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span>(<span class="dv">1</span>))
}

## clean up the workspace
<span class="kw"><a href="https://rdrr.io/r/base/rm.html">rm</a></span>(<span class="dt">list=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"AllAct"</span>,<span class="st">"AllFlags"</span>,<span class="st">"i"</span>,<span class="st">"criteria_vec"</span>,<span class="st">"nms_rm"</span>,<span class="st">"tab_miss"</span>,<span class="st">"act_var_nms"</span>))</code></pre></div>
<ol start="8" style="list-style-type: decimal">
<li>Get log(count +1) activity data in a matrix format and conduct functional Principal Component analysis (fPCA) using the fpca.face() function with 50 knots in the <em>refund</em> package in R.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Act &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="dv">1</span><span class="op">+</span>Act_Analysis[,<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"MIN"</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">1440</span>)]))
Act[<span class="kw"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(Act)] &lt;-<span class="st"> </span><span class="dv">0</span>
fpca_fit &lt;-<span class="st"> </span><span class="kw">fpca.face</span>(Act,<span class="dt">knots=</span><span class="dv">50</span>)</code></pre></div>
<ol start="9" style="list-style-type: decimal">
<li>Retain the first 6 PCs, which explain approximately 57% variability in the daily activity data (the space spanned by the rows of the matrix of non-smoothed log transformed activity counts) and obtain the score for each day on each PC and calculate the mean and standard deviation of these scores for each subject across days.</li>
</ol>
<p><img src="NHANES_accelerometry_introduction_files/figure-html/fpca_plot-1.png" width="960" style="display: block; margin: auto;"></p>
<ol start="10" style="list-style-type: decimal">
<li>Identify the PC-specific mean and standard deviation that are significantly associated with 5-year mortality using backward selection logistic model fitted with svyglm() function in R. In this step, the demographic, behavioral and comorbidity variables were included in all models and the selection was conducted on the means and standard deviations of the scores on the 6 PCs (a total of 12 variables) using the compelx survey AIC criteria (Lumley and Scott 2015).</li>
</ol>
<p>Note, there are 86 participants with missing alcohol information, which was coded as an additional level of the DrinkStatus variable. Results are presented in Table </p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Create a svydesign() object for
## estimating complex survey generalized linear models.
## Here we use the adjusted (re-weighted) 4-year normalized survey weights.
data_analysis_svy &lt;-<span class="st"> </span><span class="kw">svydesign</span>(<span class="dt">id=</span> <span class="op">~</span>SDMVPSU, <span class="dt">strata =</span> <span class="op">~</span>SDMVSTRA,
                               <span class="dt">weights =</span> <span class="op">~</span>wtmec4yr_adj_norm, <span class="dt">data =</span> data_analysis, <span class="dt">nest =</span> <span class="ot">TRUE</span>)

ind_vars  &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"mi1"</span>, <span class="st">"mi2"</span>,<span class="st">"mi3"</span>, <span class="st">"mi4"</span>,<span class="st">"mi5"</span>,<span class="st">"mi6"</span>,
               <span class="st">"si1"</span>,<span class="st">"si2"</span>,<span class="st">"si3"</span>,<span class="st">"si4"</span>,<span class="st">"si5"</span>, <span class="st">"si6"</span>)
inc_vars  &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Age"</span>, <span class="st">"SmokeCigs"</span>, <span class="st">"DrinkStatus"</span>, <span class="st">"BMI_cat"</span>,
               <span class="st">"Diabetes"</span>,<span class="st">"CHF"</span>,  <span class="st">"CHD"</span>, <span class="st">"Stroke"</span>,
               <span class="st">"Cancer"</span>, <span class="st">"MobilityProblem"</span>, <span class="st">"LBXTC"</span>,<span class="st">"LBDHDD"</span>,<span class="st">"SYS"</span>)
exc_vars &lt;-<span class="st"> </span>ind_vars
epic_vec  &lt;-<span class="st"> </span>var_vec &lt;-<span class="st"> </span>model_vec &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="ot">NA</span>, <span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(ind_vars))
<span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(ind_vars)){
     epic_ij &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="ot">NA</span>,<span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(exc_vars))

    <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(exc_vars)){
        form    &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(inc_vars, exc_vars[<span class="op">-</span>k]), <span class="dt">collapse=</span><span class="st">"+"</span>)
        fit_tmp &lt;-<span class="st"> </span><span class="kw">svyglm</span>(<span class="kw"><a href="https://rdrr.io/r/stats/formula.html">as.formula</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"yr5_mort ~"</span>, form)), <span class="dt">design=</span>data_analysis_svy,<span class="dt">family=</span><span class="kw"><a href="https://rdrr.io/r/stats/family.html">quasibinomial</a></span>())

        epic_ij[k] &lt;-<span class="st"> </span>survey<span class="op">:::</span><span class="kw">extractAIC.svyglm</span>(fit_tmp, <span class="dt">k=</span><span class="dv">4</span>)[<span class="dv">2</span>]

        <span class="kw"><a href="https://rdrr.io/r/base/rm.html">rm</a></span>(<span class="dt">list=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"fit_tmp"</span>,<span class="st">"form"</span>))
    }
    
    k_cur         &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/which.html">which</a></span>(epic_ij <span class="op">==</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(epic_ij))
    model_vec[i]  &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(inc_vars, exc_vars[<span class="op">-</span>k_cur]), <span class="dt">collapse=</span><span class="st">"+"</span>)
    exc_vars      &lt;-<span class="st"> </span>exc_vars[<span class="op">-</span>k_cur]
    epic_vec[i]   &lt;-<span class="st"> </span>epic_ij[k_cur]
    <span class="kw"><a href="https://rdrr.io/r/base/rm.html">rm</a></span>(<span class="dt">list=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"k_cur"</span>, <span class="st">"k"</span>, <span class="st">"epic_ij"</span>))
}

## get the final model as the first model where AIC increases after removing a variable
## identified mi1,  si6
backward_model &lt;-<span class="st"> </span>model_vec[<span class="kw"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/diff.html">diff</a></span>(epic_vec) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>][<span class="dv">1</span>]
fit_logistic_pca &lt;-<span class="st"> </span><span class="kw">svyglm</span>(<span class="kw"><a href="https://rdrr.io/r/stats/formula.html">as.formula</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"yr5_mort ~"</span>, backward_model)), <span class="dt">design=</span>data_analysis_svy,
                           <span class="dt">family=</span><span class="kw"><a href="https://rdrr.io/r/stats/family.html">quasibinomial</a></span>())</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ci.pca &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/confint.html">confint</a></span>(fit_logistic_pca,  <span class="dt">level =</span> <span class="fl">0.95</span>, <span class="dt">method =</span> <span class="st">"likelihood"</span>)

<span class="co">#exponentiate to convert estimated coefficients into odds ratio</span>
df2 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(df[,<span class="kw"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(df) <span class="op">==</span><span class="st"> "Estimate"</span>)]), <span class="kw"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(ci.pca))
<span class="kw"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(df2) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"OR"</span>, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Estimate"</span>, <span class="st">"Lower CL"</span>, <span class="st">"Upper CL"</span>))
df &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(df, <span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(df2,<span class="dv">3</span>))

<span class="kw">kable</span>(df, <span class="dt">caption =</span> <span class="st">"Final backward selection model estimated coefficients"</span>)<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">kable_styling</span>(<span class="st">"striped"</span>, <span class="dt">full_width =</span> F) <span class="co">#p-values </span></code></pre></div>
<table class="table table table-striped">
<caption>
Final backward selection model estimated coefficients
</caption>
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Pr(&gt;|t|)
</th>
<th style="text-align:right;">
OR Estimate
</th>
<th style="text-align:right;">
OR Lower CL
</th>
<th style="text-align:right;">
OR Upper CL
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:right;">
-7.590
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.004
</td>
</tr>
<tr>
<td style="text-align:left;">
Age
</td>
<td style="text-align:right;">
0.080
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
1.083
</td>
<td style="text-align:right;">
1.059
</td>
<td style="text-align:right;">
1.108
</td>
</tr>
<tr>
<td style="text-align:left;">
Former Smoker
</td>
<td style="text-align:right;">
0.487
</td>
<td style="text-align:right;">
0.021
</td>
<td style="text-align:right;">
1.627
</td>
<td style="text-align:right;">
1.073
</td>
<td style="text-align:right;">
2.485
</td>
</tr>
<tr>
<td style="text-align:left;">
Current Smoker
</td>
<td style="text-align:right;">
0.941
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
2.563
</td>
<td style="text-align:right;">
1.797
</td>
<td style="text-align:right;">
3.648
</td>
</tr>
<tr>
<td style="text-align:left;">
Non-Drinker
</td>
<td style="text-align:right;">
0.567
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
1.763
</td>
<td style="text-align:right;">
1.279
</td>
<td style="text-align:right;">
2.440
</td>
</tr>
<tr>
<td style="text-align:left;">
Heavy Drinker
</td>
<td style="text-align:right;">
1.053
</td>
<td style="text-align:right;">
0.002
</td>
<td style="text-align:right;">
2.866
</td>
<td style="text-align:right;">
1.423
</td>
<td style="text-align:right;">
5.576
</td>
</tr>
<tr>
<td style="text-align:left;">
Missing Alcohol
</td>
<td style="text-align:right;">
0.816
</td>
<td style="text-align:right;">
0.065
</td>
<td style="text-align:right;">
2.261
</td>
<td style="text-align:right;">
0.875
</td>
<td style="text-align:right;">
5.197
</td>
</tr>
<tr>
<td style="text-align:left;">
Underweight
</td>
<td style="text-align:right;">
0.597
</td>
<td style="text-align:right;">
0.384
</td>
<td style="text-align:right;">
1.817
</td>
<td style="text-align:right;">
0.400
</td>
<td style="text-align:right;">
6.520
</td>
</tr>
<tr>
<td style="text-align:left;">
Overweight
</td>
<td style="text-align:right;">
-0.554
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.575
</td>
<td style="text-align:right;">
0.386
</td>
<td style="text-align:right;">
0.854
</td>
</tr>
<tr>
<td style="text-align:left;">
Obese
</td>
<td style="text-align:right;">
-0.509
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.601
</td>
<td style="text-align:right;">
0.478
</td>
<td style="text-align:right;">
0.755
</td>
</tr>
<tr>
<td style="text-align:left;">
Diabetes: yes
</td>
<td style="text-align:right;">
0.286
</td>
<td style="text-align:right;">
0.161
</td>
<td style="text-align:right;">
1.331
</td>
<td style="text-align:right;">
0.879
</td>
<td style="text-align:right;">
1.989
</td>
</tr>
<tr>
<td style="text-align:left;">
CHF: yes
</td>
<td style="text-align:right;">
0.833
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
2.300
</td>
<td style="text-align:right;">
1.356
</td>
<td style="text-align:right;">
3.841
</td>
</tr>
<tr>
<td style="text-align:left;">
CHD: yes
</td>
<td style="text-align:right;">
0.113
</td>
<td style="text-align:right;">
0.671
</td>
<td style="text-align:right;">
1.120
</td>
<td style="text-align:right;">
0.649
</td>
<td style="text-align:right;">
1.879
</td>
</tr>
<tr>
<td style="text-align:left;">
Stroke: yes
</td>
<td style="text-align:right;">
0.287
</td>
<td style="text-align:right;">
0.299
</td>
<td style="text-align:right;">
1.332
</td>
<td style="text-align:right;">
0.756
</td>
<td style="text-align:right;">
2.279
</td>
</tr>
<tr>
<td style="text-align:left;">
Cancer: yes
</td>
<td style="text-align:right;">
0.273
</td>
<td style="text-align:right;">
0.100
</td>
<td style="text-align:right;">
1.314
</td>
<td style="text-align:right;">
0.939
</td>
<td style="text-align:right;">
1.823
</td>
</tr>
<tr>
<td style="text-align:left;">
Mobility Problem
</td>
<td style="text-align:right;">
0.620
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
1.859
</td>
<td style="text-align:right;">
1.270
</td>
<td style="text-align:right;">
2.719
</td>
</tr>
<tr>
<td style="text-align:left;">
Total Cholesterol
</td>
<td style="text-align:right;">
-0.003
</td>
<td style="text-align:right;">
0.243
</td>
<td style="text-align:right;">
0.997
</td>
<td style="text-align:right;">
0.992
</td>
<td style="text-align:right;">
1.002
</td>
</tr>
<tr>
<td style="text-align:left;">
HDL Cholesterol
</td>
<td style="text-align:right;">
-0.001
</td>
<td style="text-align:right;">
0.840
</td>
<td style="text-align:right;">
0.999
</td>
<td style="text-align:right;">
0.989
</td>
<td style="text-align:right;">
1.008
</td>
</tr>
<tr>
<td style="text-align:left;">
Systolic Blood Pressure
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.949
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
0.993
</td>
<td style="text-align:right;">
1.008
</td>
</tr>
<tr>
<td style="text-align:left;">
mi1
</td>
<td style="text-align:right;">
0.014
</td>
<td style="text-align:right;">
0.008
</td>
<td style="text-align:right;">
1.014
</td>
<td style="text-align:right;">
1.004
</td>
<td style="text-align:right;">
1.026
</td>
</tr>
<tr>
<td style="text-align:left;">
si6
</td>
<td style="text-align:right;">
-0.077
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.926
</td>
<td style="text-align:right;">
0.888
</td>
<td style="text-align:right;">
0.965
</td>
</tr>
</tbody>
</table>
<ol start="11" style="list-style-type: decimal">
<li>Replace the significant PC based measures with corresponding surrogate variables. This step is done to improve the interpretability and comparability (across studies) of results. For those unfamiliar with principal component analysis, reading the section “Intuition behind fPCA” below may be helpful in understanding this step further.</li>
</ol>
<p>Identifying potential surrogate measures is based on (subjective) interpretations involving the shapes of each principal component. Fundamentally, the idea is to use visual inspection of the principal components to identify the “dominant” features of each component. Then, we return to the original data, and calculate a statistic which we believe captures this dominant feature. For example, looking at the upper-left panel of the plot above in Step 10, we see that days which load negatively on the first the first principal component tend to be extremely active, while those who load positively tend to be very inactive. As a result, one reasonable “guess” at a surrogate measure which is highly associated with average first component is simply the total log transformed activity count (TLAC) for that day. If that is true, we would also expect that the average PC1 score within subjects is highly correlated with their average TLAC across days. In our data, average TLAC and average PC1 score are highly (negatively) correlated (<span class="math inline">\(\hat{\rho}\)</span> =-0.87), which is expected based on the sign of the first PC.</p>
<p>This procedure would then be repeated for each feature identified as potentially predictive. In our application, we are also interested in the standard deviation of PC6. Looking at the bottom-right panel of the plot above in Step 10, we see that there are 6 periods where the contrast is highest between days with positive and negative loadings (i.e. the difference between the <span class="math inline">\(+\)</span> and <span class="math inline">\(-\)</span> curves are largest). One reasonable guess for a statistic which is highly correlated with PC6 score is the difference in average activity during the specific time periods where positive/negative loadings are high/low, respectively. For example, days that load highly on PC6 should, on average, have higher activity during the mid morning (8AM-10AM), late afternoon (3PM-5PM) and late evening (10PM-12AM) and lower activity during the early morning (5AM-7AM), late morning/early afternoon (11AM-1PM), and early evening (6PM-8PM). Since we’re interested in the standard deviation of PC6 score, we calculate the standard deviation of average log-transformed activity counts during these periods as a surrogate measure for <span class="math inline">\(s_{i6}\)</span>. In our analysis, we used all 6 of these time periods and obtained an observed correlation of <span class="math inline">\(\hat{\rho}\)</span> = 0.87, though multiple choices can be explored to see which statistic has the highest correlation with <span class="math inline">\(s_{i6}\)</span>.</p>
</div>
</div>
<div id="correlation-between-activity-derived-predictors-and-age" class="section level1">
<h1 class="hasAnchor">
<a href="#correlation-between-activity-derived-predictors-and-age" class="anchor"></a>Correlation between activity derived predictors and age</h1>
<p>Our analysis includes 20 variables derived directly from accelerometry measurements. These variables may be highly correlated with one another and with age. The correlation plot between age and all activity derived variables is presented below. Age has high negative correlations with TAC, TLAC and positive correlation with sedentary time. TAC is highly correlated with most activity derived measures, including MVPA, SATP, Sedentary time, TLAC, and TLAC 4PM – 6PM, 6PM – 8PM, 2PM – 4PM, 12PM – 2PM, 10PM – 12 PM, 8AM – 10AM, 6AM – 8AM. ASTP, sedentary time, TLAC and SATP are among top activity derived measures that are highly correlated with multiple other variables. The surrogate for the standard deviation on the 6th PC has low correlation with other activity derived variables, which explains its contribution to the increase in AUC in the forward selection model beyond the conventional activity measures.</p>
<p>Due to high correlation among different activity summaries, many of these variables contain similar information and often replace each other in the final mortality prediction model. Thus, in practice, we suggest examining a smaller subset of activity derived variables including: TLAC, sedentary and wear time, MVPA, SATP, ASTP, and the surrogates the standard deviation of the sixth PC (SD on PC 6).</p>
<p><img src="NHANES_accelerometry_introduction_files/figure-html/unnamed-chunk-17-1.png" width="100%" style="display: block; margin: auto;"></p>
</div>
<div id="fitting-5-year-complex-survey-weighted-mortality-prediction-model" class="section level1">
<h1 class="hasAnchor">
<a href="#fitting-5-year-complex-survey-weighted-mortality-prediction-model" class="anchor"></a>Fitting 5-year complex survey weighted mortality prediction model</h1>
<p>The first step is to construct a survey object and specify corresponding survey weights.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data_analysis_svy_adj &lt;-<span class="st"> </span><span class="kw">svydesign</span>(<span class="dt">id=</span> <span class="op">~</span>SDMVPSU, 
                      <span class="dt">strata =</span> <span class="op">~</span>SDMVSTRA,
                      <span class="dt">weights =</span> <span class="op">~</span>wtmec4yr_adj_norm,
                      <span class="dt">data =</span> data_analysis, <span class="dt">nest =</span> <span class="ot">TRUE</span>)
data_analysis_svy_adj</code></pre></div>
<pre><code>## Stratified 1 - level Cluster Sampling design (with replacement)
## With (60) clusters.
## svydesign(id = ~SDMVPSU, strata = ~SDMVSTRA, weights = ~wtmec4yr_adj_norm, 
##     data = data_analysis, nest = TRUE)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(data_analysis<span class="op">$</span>SDMVPSU))</code></pre></div>
<pre><code>## [1] 2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(data_analysis<span class="op">$</span>SDMVSTRA))</code></pre></div>
<pre><code>## [1] 30</code></pre>
<p>The survey weighted logistic regression model can be fitted using svyglm() function in package survey.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">final_formula &lt;-<span class="st"> "TAC+Age+SmokeCigs+CHF+</span>
<span class="st">                DrinkStatus+ASTP+MobilityProblem+Gender+</span>
<span class="st">                sPC6+Diabetes+EducationAdult+TLAC_1+Stroke"</span>
fit_final &lt;-<span class="st"> </span><span class="kw">svyglm</span>(<span class="kw"><a href="https://rdrr.io/r/stats/formula.html">as.formula</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"yr5_mort ~"</span>, 
            final_formula )),
            <span class="dt">design=</span>data_analysis_svy_adj,
            <span class="dt">family=</span><span class="kw"><a href="https://rdrr.io/r/stats/family.html">quasibinomial</a></span>())</code></pre></div>
<p>Syntax for extracting model coefficients from the survey object is mimilar to that of lm() and glm() functions in R.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(fit_final)<span class="op">$</span>coefficients, <span class="dv">3</span>)
<span class="kw">kable</span>(df)<span class="op">%&gt;%</span><span class="st">  </span>
<span class="st">  </span><span class="kw">kable_styling</span>(<span class="st">"striped"</span>, <span class="dt">full_width =</span> F, <span class="dt">font_size =</span> <span class="dv">8</span>)</code></pre></div>
<p>Table  presents estimated final model coefficients with corresponding standard errors and significance values, according to the complex survey design of NHANES via the svyglm() function. The number of variables used in the model is selected according to across validated AUC criteria. The “adjusted” weights we use for regression analyses are “wtmec4yr_adj_norm”. These weights are calculated using the reweight_accel() function (see ?reweight_accel for help) which re-weights observed participants using age, gender, and ethnicity strata.</p>
<p>Finally, we construct confidence intervals for estimated regression coefficients and exponentiate these values to convert to OR confidence intervals.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ci.final &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/confint.html">confint</a></span>(fit_final,  <span class="dt">level =</span> <span class="fl">0.95</span>, <span class="dt">method =</span> <span class="st">"likelihood"</span>)

<span class="co">#exponentiate to convert estimated coefficients into odds ratio</span>
<span class="co">#exponentiate to convert estimated coefficients into odds ratio</span>
df2 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(df[,<span class="kw"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(df) <span class="op">==</span><span class="st"> "Estimate"</span>)]), <span class="kw"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(ci.final))
<span class="kw"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(df2) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"OR"</span>, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Estimate"</span>, <span class="st">"Lower CL"</span>, <span class="st">"Upper CL"</span>))
df &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(df, <span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(df2,<span class="dv">3</span>))

## selected using the adjusted survey weight model
<span class="kw">kable</span>(df,<span class="dt">caption =</span> <span class="st">"Estimated final model coefficients with corresponding standard errors and significance values"</span>) <span class="op">%&gt;%</span><span class="st">  </span>
<span class="st">  </span><span class="kw">kable_styling</span>(<span class="st">"striped"</span>, <span class="dt">full_width =</span> F)</code></pre></div>
<table class="table table table-striped">
<caption>
Estimated final model coefficients with corresponding standard errors and significance values
</caption>
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Pr(&gt;|t|)
</th>
<th style="text-align:right;">
OR Estimate
</th>
<th style="text-align:right;">
OR Lower CL
</th>
<th style="text-align:right;">
OR Upper CL
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:right;">
-9.511
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.001
</td>
</tr>
<tr>
<td style="text-align:left;">
TAC
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.982
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
1.000
</td>
</tr>
<tr>
<td style="text-align:left;">
Age
</td>
<td style="text-align:right;">
0.083
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
1.087
</td>
<td style="text-align:right;">
1.063
</td>
<td style="text-align:right;">
1.112
</td>
</tr>
<tr>
<td style="text-align:left;">
Former Smoker
</td>
<td style="text-align:right;">
0.332
</td>
<td style="text-align:right;">
0.176
</td>
<td style="text-align:right;">
1.394
</td>
<td style="text-align:right;">
0.835
</td>
<td style="text-align:right;">
2.345
</td>
</tr>
<tr>
<td style="text-align:left;">
Current Smoker
</td>
<td style="text-align:right;">
0.797
</td>
<td style="text-align:right;">
0.002
</td>
<td style="text-align:right;">
2.219
</td>
<td style="text-align:right;">
1.412
</td>
<td style="text-align:right;">
3.478
</td>
</tr>
<tr>
<td style="text-align:left;">
CHF: yes
</td>
<td style="text-align:right;">
0.777
</td>
<td style="text-align:right;">
0.013
</td>
<td style="text-align:right;">
2.175
</td>
<td style="text-align:right;">
1.177
</td>
<td style="text-align:right;">
3.930
</td>
</tr>
<tr>
<td style="text-align:left;">
Non-Drinker
</td>
<td style="text-align:right;">
0.565
</td>
<td style="text-align:right;">
0.010
</td>
<td style="text-align:right;">
1.759
</td>
<td style="text-align:right;">
1.165
</td>
<td style="text-align:right;">
2.677
</td>
</tr>
<tr>
<td style="text-align:left;">
Heavy Drinker
</td>
<td style="text-align:right;">
0.963
</td>
<td style="text-align:right;">
0.018
</td>
<td style="text-align:right;">
2.620
</td>
<td style="text-align:right;">
1.148
</td>
<td style="text-align:right;">
5.673
</td>
</tr>
<tr>
<td style="text-align:left;">
Missing Alcohol
</td>
<td style="text-align:right;">
0.747
</td>
<td style="text-align:right;">
0.106
</td>
<td style="text-align:right;">
2.111
</td>
<td style="text-align:right;">
0.752
</td>
<td style="text-align:right;">
5.193
</td>
</tr>
<tr>
<td style="text-align:left;">
ASTP
</td>
<td style="text-align:right;">
4.305
</td>
<td style="text-align:right;">
0.016
</td>
<td style="text-align:right;">
74.069
</td>
<td style="text-align:right;">
2.328
</td>
<td style="text-align:right;">
2380.239
</td>
</tr>
<tr>
<td style="text-align:left;">
Mobility Problem
</td>
<td style="text-align:right;">
0.546
</td>
<td style="text-align:right;">
0.028
</td>
<td style="text-align:right;">
1.726
</td>
<td style="text-align:right;">
1.057
</td>
<td style="text-align:right;">
2.816
</td>
</tr>
<tr>
<td style="text-align:left;">
Gender: female
</td>
<td style="text-align:right;">
-0.648
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:right;">
0.523
</td>
<td style="text-align:right;">
0.332
</td>
<td style="text-align:right;">
0.817
</td>
</tr>
<tr>
<td style="text-align:left;">
SD on PC 6 (surrogate)
</td>
<td style="text-align:right;">
-1.077
</td>
<td style="text-align:right;">
0.002
</td>
<td style="text-align:right;">
0.341
</td>
<td style="text-align:right;">
0.180
</td>
<td style="text-align:right;">
0.635
</td>
</tr>
<tr>
<td style="text-align:left;">
Diabetes: yes
</td>
<td style="text-align:right;">
0.216
</td>
<td style="text-align:right;">
0.310
</td>
<td style="text-align:right;">
1.241
</td>
<td style="text-align:right;">
0.780
</td>
<td style="text-align:right;">
1.937
</td>
</tr>
<tr>
<td style="text-align:left;">
High school Education
</td>
<td style="text-align:right;">
-0.008
</td>
<td style="text-align:right;">
0.973
</td>
<td style="text-align:right;">
0.992
</td>
<td style="text-align:right;">
0.582
</td>
<td style="text-align:right;">
1.694
</td>
</tr>
<tr>
<td style="text-align:left;">
More than high school Education
</td>
<td style="text-align:right;">
-0.231
</td>
<td style="text-align:right;">
0.309
</td>
<td style="text-align:right;">
0.794
</td>
<td style="text-align:right;">
0.489
</td>
<td style="text-align:right;">
1.294
</td>
</tr>
<tr>
<td style="text-align:left;">
TLAC 12AM-2AM
</td>
<td style="text-align:right;">
0.002
</td>
<td style="text-align:right;">
0.099
</td>
<td style="text-align:right;">
1.002
</td>
<td style="text-align:right;">
0.999
</td>
<td style="text-align:right;">
1.005
</td>
</tr>
<tr>
<td style="text-align:left;">
StrokeYes
</td>
<td style="text-align:right;">
0.193
</td>
<td style="text-align:right;">
0.505
</td>
<td style="text-align:right;">
1.213
</td>
<td style="text-align:right;">
0.636
</td>
<td style="text-align:right;">
2.227
</td>
</tr>
</tbody>
</table>
<div id="intuition-behind-fpca" class="section level2">
<h2 class="hasAnchor">
<a href="#intuition-behind-fpca" class="anchor"></a>Intuition behind fPCA</h2>
<p>A major problem with PC analysis is that it is not always intuitive and requires a degree of familiarity with matrix algebra and complex trajectories (functional data analysis in statistics speak). While some of these problems are unavoidable given the complexity of the data, we will now provide the needed intuition for understanding both the PCs and the implication of our findings on the original data scale (daily minute-level activity profiles). We will start with explaining the first 2PCs, which are shown in the left-top panel of Figure 1.</p>
<p><img src="NHANES_accelerometry_introduction_files/figure-html/plot_PC_profiles-1.png" width="960" style="display: block; margin: auto;"></p>
<p>The first PC (solid blue line) captures 22% of the overall variability in the observed daily profiles of activity. It has a distinct shape, with values starting negative between 12AM and 5AM then becoming strongly positive with a peak around 8AM and slowly decreasing but staying positive until 9:30PM, and then becoming negative after 9:30PM. This is exactly what we expected to see. For each subject, we have 3 - 7 days of valid activity data. Individuals with a positive score on this component (a.k.a., positively loaded on the first PC) on a given day will tend to have less activity during the night hours and more activity during the day hours than the average activity across all subject-days. The biggest difference between such a subject’s day and the average daily activity across all subjects is centered on the morning hours (8AM-9AM). In contrast, the second PC (dashed line) captures 14% of the overall variability in the observed daily activity profiles. It starts positive between 12AM and 2AM, then becomes negative between 2AM and 11AM, with a negative peak at 8AM, increases between 11 AM and 8PM, and decreases while staying positive after 8PM. Participants days with positive scores on this component will be more active in the evening than the average individuals dayly activity.</p>
<p>Now, let us investigate in detail the connection between PCs, scores and individual daily trajectories. The right panel in Figure 1 displays the one day of activity profiles for 3 subjects. Here, we plot the activity data smoothed for each subject and day using thin-plate penalized spline with 30 knots as implemented in the <strong>gam()</strong> function in the <strong>mgcv</strong> package in R. The individual days for subjects 21009 (red line) and 21913 (green line) have overall high activity, which is reflected by the high positive loadings on PC 1 (55.89 and 58.75, respectively). In contrast, the individual day’s activity for subject 21039 (blue line) has lower levels, which is reflected by the negative score on the first PC (-21.12). Subjects 21009 (red line) and 21039 (blue line) are mostly active between 7AM and 9PM and their corresponding scores of the second principal component are negative (-30.91 and -36.08, respectively). Subject 21913 (green line) is however, unusually highly active during night hours (8PM - 2AM) with a highly positive score on the second PC (66.05).</p>
<p>The last, but not least important interpretation is of means of scores versus standard deviation of scores. In Figure 1, we have displayed three days, one for each subject. However, each subject has multiple days and each day will get a score and a pattern. For example, on days when subject 21009 (red line) is less active the score on PC1 will be lower, even if the general pattern stays the same. Thus, for every subject and PC we obtain a vector of scores; for 21009 (red line) we obtain (38.39, 55.89, 35.55, 60.61, 40.91, 48.67, -21.25) on the first PC, where we showed only the trajectory corresponding to the 3rd day. What we calculate is the mean of these scores, 36.97, and the standard deviation, 27.27. The mean of the scores is relatively easy to interpret, as it represents whether the average of the 7 days is higher or lower on PC1. The standard deviation captures the day-to-day variability of the individual. In this case the mean and standard deviation for subject 21009 (red line) were 36.97 and 27.27, respectively. In contrast, for subject 21039 (blue line), the mean and standard deviation were -19.16 and 5.02, respectively, much smaller than for subject 21009 (red line). This means that both the overall mean and the daily variability around this larger mean are larger for subject 21009 than for subject 21039 (blue line). This is depicted in Figure 2, where we show smoothed activity data for all days for subjects 21009 (Figure 2a red lines) and 21039 (Figure 2b blue lines). Note that the red lines tend to be higher the blue lines and that the blue lines are less variable around their means. We conclude that, in general, average PC1 scores will tend to distinguish between lower and higher activity individuals whose are, on average, more active over the course of days with available activity data. In contrast, average PC2 scores will distinguish between individuals who, on average, have high activity in the morning and low in the evening/night and individuals who, on average, have lower activity intensity in the morning and higher during the evening/nighttime.</p>
<p>Of course, things are more complicated once we start interpreting every component. Instead, in Table 1 we will provide just the interpretation of those components and summaries that were found to be predictive of the outcome.</p>
<p><img src="NHANES_accelerometry_introduction_files/figure-html/unnamed-chunk-25-1.png" width="960" style="display: block; margin: auto;"></p>
<table class="table table table-striped">
<caption>
Table 3: Interpretation of the results of FPCA
</caption>
<thead><tr>
<th style="text-align:left;">
Result
</th>
<th style="text-align:left;">
Interpretation
</th>
<th style="text-align:left;">
Surrogates
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
(-) association mi1
</td>
<td style="text-align:left;">
Individuals with higher levels of overall activity during the day, and those who have higher early afternoon activity relative to early AM are associated with later mortality
</td>
<td style="text-align:left;">
<ol style="list-style-type: decimal"><li>Average TLAC
</li></ol>
</td>
</tr>
<tr>
<td style="text-align:left;">
(+) association si6
</td>
<td style="text-align:left;">
Individuals who are more variable in the start time of their daily activity are associated with earlier mortality.
</td>
<td style="text-align:left;">
<ol style="list-style-type: decimal"><li>Standard deviation of ratio of mid-day to morning/afternoon activity 2. Standard deviation of the difference in average activity during peaks/troughs highlighted by PC6
</li></ol>
</td>
</tr>
</tbody>
</table>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<ol style="list-style-type: decimal">
<li><p>T Lumley, and A Scott; AIC and BIC for modeling with complex survey data, <em>Journal of Survey Statistics and Methodology</em>, Volume 3, Issue 1, 1 March 2015, Pages 1-18, <a href="https://doi.org/10.1093/jssam/smu021" class="uri">https://doi.org/10.1093/jssam/smu021</a></p></li>
<li><p>A Leroux, E Smirnova, Q Cao, and C Crainiceanu. rnhanesdata: NHANES Accelerometry Data Pipeline. URL:<a href="https://github.com/andrew-leroux/rnhanesdata" class="uri">https://github.com/andrew-leroux/rnhanesdata</a>. R package version 1.0.</p></li>
<li><p>E Smirnova, A Leroux, Q Cao, L Tabacu, V Zipunnikov, C Crainiceanu, and J Urbanek. The Predictive Performance of Objective Measures of Physical Activity Derived From Accelerometry Data for 5-Year All-Cause Mortality in Older Adults: National Health and and Nutritional Examination Survey 2003–2006, <em>The Journals of Gerontology: Series A</em>, glz193, <a href="https://doi.org/10.1093/gerona/glz193" class="uri">https://doi.org/10.1093/gerona/glz193</a>.</p></li>
<li><p>A Leroux, J Di, E Smirnova, E Mcguffey, Q Cao, E Bayatmokhtari, L Tabacu, V Zipunnikov, J Urbanek, C Crainiceanu. Organizing and Analyzing the Activity Data in NHANES, <em>Statistics in Biosciences</em>, 1-26, 2019.</p></li>
</ol>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#prerequisites">Prerequisites</a><ul class="nav nav-pills nav-stacked">
<li><a href="#nhanes-2003-2004-and-2005-2006-5-year-mortality-model-data-selection">NHANES 2003-2004 and 2005-2006 5-year mortality model data selection</a></li>
      </ul>
</li>
      <li><a href="#correlation-between-activity-derived-predictors-and-age">Correlation between activity derived predictors and age</a></li>
      <li>
<a href="#fitting-5-year-complex-survey-weighted-mortality-prediction-model">Fitting 5-year complex survey weighted mortality prediction model</a><ul class="nav nav-pills nav-stacked">
<li><a href="#intuition-behind-fpca">Intuition behind fPCA</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Andrew Leroux.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
